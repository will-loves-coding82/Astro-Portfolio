---
import "../../styles/global.css";
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';
import Layout from "../../layouts/Layout.astro";

const images = await Astro.glob<{default: ImageMetadata}>('../../../public/images/gallery/*').then(files => {
    return files.map(file => file.default);
})


---


<script>

    import { gsap } from "gsap";
    import { ScrollTrigger } from "gsap/ScrollTrigger";
    import { ScrollToPlugin } from "gsap/ScrollToPlugin";

    document.addEventListener("astro:page-load", () => {
        gsap.registerPlugin(ScrollTrigger, ScrollToPlugin);

        const scrollableImages = document.querySelectorAll(".scrollable-image") as NodeListOf<HTMLElement>;
        const pinnedImages = document.querySelectorAll(".pinned-image") as NodeListOf<HTMLElement>;

        pinnedImages.forEach((pinned, idx) => {
          pinned.addEventListener('click', ()=> {
                gsap.to(window, { duration: 0.5,ease: "expo.out", scrollTo: { y: `#scrollable-${idx}`, offsetY: 50 } });
            })
        })

                  
        scrollableImages.forEach((_, idx) => {
            const pinnedImage = document.querySelector(`#pinned-${idx}`) as HTMLElement;
            const originalZ = pinnedImage.style.zIndex;
            gsap.set(pinnedImage, { opacity: 0.5 });
            ScrollTrigger.create({
                trigger: `#scrollable-${idx}`,
                start: "top+=50% center",
                end: "bottom+=50% center",
                onEnter: () => gsap.to(pinnedImage, { opacity: 1, duration: 0.3, scale: 1.1, zIndex: 100, borderColor: "white", borderWidth: 2}),
                onEnterBack: () => gsap.to(pinnedImage, { opacity: 1, duration: 0.3, scale: 1.1, zIndex: 100, borderColor: "white", borderWidth: 2}),
                onLeave: () => gsap.to(pinnedImage, { opacity: 0.5, duration: 0.3, scale: 1, zIndex: originalZ, borderColor: "transparent"}),
                onLeaveBack: () => gsap.to(pinnedImage, { opacity: 0.5, duration: 0.3, scale: 1, zIndex: originalZ, borderColor: "transparent"}),
            })
        })


        ScrollTrigger.create({
            trigger: "#pinned-images-container",
            pin: true, 
            start: 'top-=200px top',
            end: 'bottom+=4600px bottom',
            // markers: true
        })
    });
</script>

<style>
    .translate-right {
        transform: translateX(100px);
    }

    .translate-left {
        transform: translateX(-100px);
    }
    

    @media screen and (max-width: 1268px) {
        .scrollable-image {
            transform: translateX(0) !important;
        }
    }
</style>



<Layout >
    
    <section data-lag class="flex flex-col w-full px-8 mx-auto pt-20 xl:px-0">

        <hgroup class="py-32 max-w-5xl mx-auto">
            <h1 class="secondary-title text-white text-left md:text-center w-full">Visual Gallery</h1>
            <p class="primary-header-2 text-(--color-gray) font-thin mt-8 text-left md:text-center w-full mx-auto lg:px-16">A collection of personally selected digital art and photos over the years.</p>
        </hgroup>
    </section>

    <section class="w-full px-8 mt-24 flex justify-center xl:justify-evenly xl:gap-80 items-start mx-auto max-w-[1368px]">

        <ul id="scrollable-images-container" class="flex flex-col md:max-w-xl max-w-2xl gap-12">
            {images.map((image, idx) => (
                <Image 
                    data-lag={idx % 2 == 0 ? "0.2" : "0"} 
                    id={`scrollable-${idx}`}
                    src={image} 
                    alt="" 
                    loading="lazy" 
                    style={`transform: translateX(${idx % 2 == 0 ? '100px' : '-100px'});`}
                    class={`peer scrollable-image object-contain h-full rounded-lg ${idx % 2 == 0 ? 'translate-right' : 'translate-left'}`}
                />
            ))}  
        </ul>


        <div id="pinned-images-container" class="hidden max-w-[80px] xl:block">
            <ul>
                {images.map((image, idx) => (
                    <Image 
                        id={`pinned-`+idx} 
                        src={image} 
                        alt="" 
                        loading="lazy" 
                        style={`transform: translateX(${idx % 2 == 0 ? '8px' : '-8px'}); z-index:${idx % 2 == 0 ? 10 : 0};`}
                        class={`pinned-image hover:cursor-pointer opacity-100 relative object-contain h-full rounded-lg mt-[-4px]`}
                    />  
            ))}    
            </ul>

        </div>

    </section>
</Layout>

